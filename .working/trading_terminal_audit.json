{
  "file": "src/pages/TradingTerminal.tsx",
  "audit_date": "2025-12-06",
  "severity_summary": {
    "critical_bugs": 0,
    "warnings": 4,
    "clean_patterns": 8
  },
  "critical_bugs": [],
  "warnings": [
    {
      "line": 451,
      "issue": "Function passed to useState instead of being called - stats will be re-initialized on every render",
      "fix": "Change: const [stats] = useState(generateDemoStats); to: const [stats] = useState(generateDemoStats());",
      "severity": "high",
      "category": "React anti-pattern"
    },
    {
      "line": 452,
      "issue": "Function passed to useState instead of being called - forces will be re-initialized on every render",
      "fix": "Change: const [forces] = useState(generateForceVectors); to: const [forces] = useState(generateForceVectors());",
      "severity": "high",
      "category": "React anti-pattern"
    },
    {
      "line": 502,
      "issue": "Missing 'setShowShortcuts' in useEffect dependency array - could cause stale closure with old value",
      "fix": "Add 'setShowShortcuts' to dependency array: }, [isFullscreen, setShowShortcuts]);",
      "severity": "medium",
      "category": "React anti-pattern (stale closure)"
    },
    {
      "line": 288,
      "issue": "Undefined access: regimeConfig[regime] could fail if regime is not in the object. No fallback provided.",
      "fix": "Add fallback: const current = regimeConfig[regime] || regimeConfig['TRENDING_UP'];",
      "severity": "medium",
      "category": "Undefined access"
    }
  ],
  "division_by_zero": [],
  "null_checks": [
    {
      "line": 369,
      "pattern": "events.slice(0, 50).map((event, i) => ...)",
      "status": "SAFE",
      "reason": "Guarded by events.length === 0 check above. events always exists (useJarvisEvents hook always returns array)."
    },
    {
      "line": 382,
      "pattern": "event.timestamp || Date.now()",
      "status": "SAFE",
      "reason": "Uses || operator for fallback. Event objects are guaranteed by hook."
    }
  ],
  "memory_leaks": [
    {
      "line": "500-501",
      "pattern": "Event listener cleanup",
      "status": "SAFE",
      "reason": "Proper cleanup: window.removeEventListener called in return function. No memory leak here.",
      "description": "useEffect properly registers and cleans up keydown listener"
    }
  ],
  "react_antipatterns": [
    {
      "line": 451,
      "pattern": "useState(generateDemoStats)",
      "status": "VIOLATION",
      "reason": "Passing function reference instead of calling it. Function will be called on every render, recreating object.",
      "fix": "Use useState(generateDemoStats()) or useMemo"
    },
    {
      "line": 452,
      "pattern": "useState(generateForceVectors)",
      "status": "VIOLATION",
      "reason": "Same issue as above - function passed instead of called"
    },
    {
      "line": 464,
      "pattern": "useEffect with keyboard handler",
      "status": "SAFE",
      "reason": "Handler is properly defined inside effect, cleanup is correct, but dependency array has minor issue"
    }
  ],
  "performance_issues": [
    {
      "line": "333-397",
      "component": "LiveEventsPanel",
      "pattern": "events.slice(0, 50).map(...)",
      "status": "GOOD",
      "reason": "Slices to 50 events to prevent rendering too many items. Good for performance."
    },
    {
      "line": "216-273",
      "component": "ForceVectorPanel",
      "pattern": "forces.map(...)",
      "status": "GOOD",
      "reason": "Safe - forces array is always defined and has fixed length from generateForceVectors()"
    },
    {
      "line": "579-593",
      "pattern": "Grid layout with fixed columns",
      "status": "GOOD",
      "reason": "CSS grid used correctly - no layout thrashing or expensive DOM operations"
    }
  ],
  "clean_patterns": [
    {
      "line": "500-501",
      "pattern": "Event listener cleanup in useEffect return",
      "description": "Proper cleanup of event listeners prevents memory leaks. Returns cleanup function that removes listener."
    },
    {
      "line": "369-390",
      "pattern": "Conditional rendering with fallback UI",
      "description": "events.length === 0 check shows appropriate empty state with helpful message before rendering list"
    },
    {
      "line": "184-198",
      "pattern": "Conditional styling with cn() utility",
      "description": "Uses cn() for conditional class names, avoiding inline objects. Consistent pattern throughout."
    },
    {
      "line": "135-171",
      "pattern": "Sub-component with props drilling",
      "description": "GamifiedHeader properly receives only needed props (stats). No over-drilling."
    },
    {
      "line": "410-435",
      "pattern": "Mapping with proper keys",
      "description": "All map() operations use stable keys (achievement.id, force.name, etc). No index-based keys."
    },
    {
      "line": "315-326",
      "pattern": "onClick handler with closure",
      "description": "onClick={() => setRegime(key)} properly captures key in closure. No stale closure issue here."
    },
    {
      "line": "552",
      "pattern": "Tabs component with controlled value",
      "description": "activeTab state properly controls Tabs component, bidirectional with onValueChange callback"
    },
    {
      "line": "454-461",
      "pattern": "Hook usage from useJarvisEvents",
      "description": "Properly destructures all needed values from custom hook. Events, connected state, pipeline stages all used correctly."
    }
  ],
  "detailed_analysis": {
    "GamifiedHeader": {
      "line": 135,
      "issues": [],
      "status": "CLEAN",
      "xpPercent_calculation": "Safe - stats.xp and stats.xpToNext guaranteed to exist and be numbers"
    },
    "ForceVectorPanel": {
      "line": 216,
      "issues": [],
      "status": "CLEAN",
      "netForce_calculation": "Safe - forces is always an array, reduce is safe",
      "note": "No division by zero, no NaN issues"
    },
    "RegimeIndicator": {
      "line": 275,
      "issues": [
        {
          "line": 288,
          "pattern": "const current = regimeConfig[regime];",
          "problem": "regime could be any string; if not in regimeConfig, current will be undefined",
          "impact": "Line 302 current.color would throw 'Cannot read property color of undefined'",
          "likelihood": "LOW - regime is set via onClick handlers to keys from regimeConfig, but could be externally modified"
        }
      ],
      "status": "WARNING"
    },
    "LiveEventsPanel": {
      "line": 333,
      "issues": [],
      "status": "CLEAN",
      "notes": [
        "events from hook is always an array",
        "events.slice(0, 50) is safe - slice returns empty array if events is empty",
        "Map uses event.id || i for key - reasonable fallback",
        "Timestamp fallback Date.now() prevents NaN"
      ]
    },
    "Main_TradingTerminal_Component": {
      "line": 446,
      "critical_issues": [
        {
          "line": 451,
          "variable": "stats",
          "problem": "useState(generateDemoStats) - function not called",
          "explanation": "React will call this on every render, recreating stats object each time. Should be useState(generateDemoStats())",
          "consequence": "Performance degradation, unnecessary re-renders, stats object always new reference"
        },
        {
          "line": 452,
          "variable": "forces",
          "problem": "useState(generateForceVectors) - function not called",
          "explanation": "Same issue as stats",
          "consequence": "Performance degradation"
        }
      ],
      "medium_issues": [
        {
          "line": 502,
          "pattern": "useEffect dependency array",
          "issue": "Missing setShowShortcuts in dependencies",
          "explanation": "Handler closes over setShowShortcuts, but it's not in dependency array. While setShowShortcuts is stable (from useState), it's a violation of React best practices",
          "eslint_rule": "react-hooks/exhaustive-deps"
        }
      ],
      "status": "ISSUES FOUND"
    }
  },
  "recommendations": {
    "priority_1": [
      "Fix line 451: Change useState(generateDemoStats) to useState(generateDemoStats())",
      "Fix line 452: Change useState(generateForceVectors) to useState(generateForceVectors())",
      "Fix line 288: Add fallback - const current = regimeConfig[regime] || regimeConfig['TRENDING_UP'];"
    ],
    "priority_2": [
      "Fix line 502: Add setShowShortcuts to dependency array"
    ],
    "no_action_needed": [
      "Event listener cleanup is proper",
      "No division by zero bugs found",
      "No serious null/undefined access issues",
      "No memory leaks detected",
      "Event mapping is safe with proper guards"
    ]
  },
  "test_suggestions": [
    {
      "test": "Change regime to undefined string and verify RegimeIndicator doesn't crash",
      "covers": "Line 288 undefined access"
    },
    {
      "test": "Re-render component and verify stats/forces objects are same reference",
      "covers": "Lines 451-452 useState anti-pattern"
    },
    {
      "test": "Rapidly toggle fullscreen and verify keyboard handlers work correctly",
      "covers": "Line 502 dependency array"
    }
  ]
}
